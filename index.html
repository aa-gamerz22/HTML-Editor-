<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gemini Ultra IDE | Elite Master Pro</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" data-name="vs/editor/editor.main" href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs/editor/editor.main.min.css">
    
    <style>
        :root {
            --bg: #030508; --side: #0a0d14; --accent: #00ff88; --border: #1e293b;
            --glass: rgba(255, 255, 255, 0.03); --text: #f1f5f9; --panel: #0f172a;
        }

        [data-theme="cyber"] { --bg: #0d0221; --side: #0f0524; --accent: #ff00ff; --border: #ff00ff44; }
        [data-theme="oled"] { --bg: #000000; --side: #000000; --accent: #00ff88; --border: #111; }
        [data-theme="gold"] { --bg: #0c0c04; --side: #14140a; --accent: #ffd700; --border: #2b2b14; }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body { 
            font-family: 'Outfit', sans-serif; background: var(--bg); color: var(--text); 
            height: 100vh; overflow: hidden; display: flex; flex-direction: column; transition: 0.4s ease;
        }

        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes dots { 0% { content: '.'; } 33% { content: '..'; } 66% { content: '...'; } }
        .installing-anim::after { content: '...'; animation: dots 1.5s infinite; }

        .navbar {
            height: 65px; background: var(--side); border-bottom: 1px solid var(--border);
            display: flex; align-items: center; padding: 0 20px; justify-content: space-between;
            z-index: 1000; backdrop-filter: blur(15px);
        }

        .main-shell { display: flex; flex: 1; overflow: hidden; position: relative; }

        .sidebar {
            width: 300px; background: var(--side); border-right: 1px solid var(--border);
            display: flex; flex-direction: column; transition: 0.5s cubic-bezier(0.16, 1, 0.3, 1);
            overflow-y: auto; z-index: 200;
        }
        @media (max-width: 768px) { .sidebar { position: absolute; left: -300px; height: 100%; } .sidebar.active { transform: translateX(300px); box-shadow: 20px 0 60px #000; } }

        .editor-zone { flex: 1; position: relative; overflow: hidden; background: #1e1e1e; }
        #monaco-container, #simple-container { width: 100%; height: 100%; position: absolute; top: 0; left: 0; display: none; }
        #simple-container { 
            background: #1e1e1e; color: #d4d4d4; padding: 20px; font-family: 'Fira Code', monospace;
            border: none; outline: none; resize: none; line-height: 1.6;
        }
        .active-view { display: block !important; }

        .btn {
            background: var(--glass); border: 1px solid var(--border); color: inherit;
            padding: 14px; border-radius: 12px; cursor: pointer; display: flex; align-items: center;
            gap: 12px; width: 100%; margin-bottom: 10px; transition: 0.3s; font-weight: 500;
        }
        .btn:hover { background: var(--border); border-color: var(--accent); }
        .btn-run { 
            background: var(--accent); color: #000; font-weight: 800; border-radius: 50px; 
            padding: 10px 25px; border: none; cursor: pointer; box-shadow: 0 0 15px var(--accent);
        }

        .modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9); backdrop-filter: blur(20px);
            z-index: 5000; display: none; align-items: center; justify-content: center; padding: 20px;
        }
        .modal-card {
            background: var(--panel); width: 100%; max-width: 500px; max-height: 85vh;
            border-radius: 30px; border: 1px solid var(--border); display: flex; flex-direction: column;
            animation: slideUp 0.4s cubic-bezier(0.2, 1, 0.3, 1);
        }
        .modal-body { padding: 25px; overflow-y: auto; flex: 1; }

        .perm-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--glass); border-radius: 12px; margin-bottom: 8px; border: 1px solid transparent; font-size: 13px; }

        /* --- New Minimal Back Arrow --- */
        #output-screen { 
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; 
            background: #fff; z-index: 99999; display: none;
        }
        .back-nav { 
            position: absolute; top: 20px; left: 20px; color: #000; 
            font-size: 32px; z-index: 100000; cursor: pointer; 
            opacity: 0.6; transition: 0.3s; line-height: 1;
        }
        .back-nav:hover { opacity: 1; transform: translateX(-3px); }
        iframe { width: 100%; height: 100%; border: none; background: #fff; }

        input[type="range"] { width: 100%; accent-color: var(--accent); }
    </style>
</head>
<body data-theme="dark">

    <nav class="navbar">
        <div style="display:flex; align-items:center; gap:15px;">
            <button onclick="toggleSidebar()" style="background:none; border:none; color:inherit; font-size:28px;">‚ò∞</button>
            <h2 id="file-title" style="font-size:14px; color:var(--accent); text-transform:uppercase; letter-spacing:1px;">Elite Master</h2>
        </div>
        <div style="display:flex; align-items:center; gap:12px;">
            <button class="btn-run" onclick="runApp()">RUN ‚ñ∂</button>
            <button onclick="toggleFS()" style="background:none; border:none; color:inherit; font-size:20px;">‚õ∂</button>
        </div>
    </nav>

    <div class="main-shell">
        <aside class="sidebar" id="sidebar">
            <div style="padding:25px;">
                <p style="font-size:10px; opacity:0.5; margin-bottom:15px; letter-spacing:2px;">CORE SYSTEM</p>
                <button class="btn" onclick="openFolder()">üìÅ Open Folder</button>
                <button class="btn" onclick="createFile()">üìÑ Create File</button>
                <div id="explorer-tree" style="margin: 20px 0;"></div>
                
                <hr style="opacity:0.1; margin:30px 0;">
                <button class="btn" onclick="openModal('lib-modal')">üíé Library Hub</button>
                <button class="btn" onclick="openModal('config-modal')">üõ† Control Center</button>
            </div>
        </aside>

        <section class="editor-zone">
            <div id="monaco-container" class="active-view"></div>
            <textarea id="simple-container" spellcheck="false" placeholder="Simple Mode..."></textarea>
        </section>
    </div>

    <div class="modal" id="config-modal">
        <div class="modal-card">
            <div class="modal-body">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <h3>Control Center</h3>
                    <span onclick="closeModal('config-modal')" style="cursor:pointer; font-size:24px;">‚úï</span>
                </div>
                
                <div style="display:flex; flex-direction:column; gap:20px;">
                    <label>Editor Engine:
                        <select id="engine-mode" onchange="setEngine(this.value)" style="width:100%; padding:12px; background:var(--bg); color:#fff; border:1px solid var(--border); border-radius:12px; margin-top:5px;">
                            <option value="monaco">Professional Monaco</option>
                            <option value="simple">Native Simple</option>
                        </select>
                    </label>

                    <label>Font Size: <span id="font-val">16</span>px
                        <input type="range" min="10" max="40" value="16" oninput="updateFontSize(this.value)" style="margin-top:8px;">
                    </label>

                    <label>Word Wrap (Fit/Fill):
                        <select onchange="updateWrap(this.value)" style="width:100%; padding:12px; background:var(--bg); color:#fff; border:1px solid var(--border); border-radius:12px; margin-top:5px;">
                            <option value="on">Fit Content (Wrap ON)</option>
                            <option value="off">Fill Content (Wrap OFF)</option>
                        </select>
                    </label>

                    <label>Permissions (Web API):
                        <div style="margin-top:10px; display:flex; flex-direction:column; gap:5px;">
                            <div class="perm-item"><span>Camera & Mic</span> <input type="checkbox" checked id="p-media"></div>
                            <div class="perm-item"><span>Location GPS</span> <input type="checkbox" checked id="p-geo"></div>
                            <div class="perm-item"><span>Notifications</span> <input type="checkbox" checked id="p-notif"></div>
                            <div class="perm-item"><span>Bluetooth & NFC</span> <input type="checkbox" id="p-wireless"></div>
                            <div class="perm-item"><span>Sensors (Gyro/Mag)</span> <input type="checkbox" checked id="p-sensors"></div>
                            <div class="perm-item"><span>Battery Status</span> <input type="checkbox" checked id="p-batt"></div>
                        </div>
                    </label>

                    <label>Elite Theme:
                        <select onchange="document.body.setAttribute('data-theme', this.value)" style="width:100%; padding:12px; background:var(--bg); color:#fff; border:1px solid var(--border); border-radius:12px; margin-top:5px;">
                            <option value="dark">Deep Space</option>
                            <option value="oled">Pure OLED</option>
                            <option value="cyber">Cyber Neon</option>
                            <option value="gold">Gold Luxury</option>
                        </select>
                    </label>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="lib-modal">
        <div class="modal-card">
            <div class="modal-body">
                <h3 style="margin-bottom:20px; display:flex; justify-content:space-between;">Elite Libraries <span onclick="closeModal('lib-modal')" style="cursor:pointer">‚úï</span></h3>
                <div id="lib-market-list"></div>
            </div>
        </div>
    </div>

    <div id="output-screen">
        <div class="back-nav" onclick="closeOutput()">‚Üê</div>
        <iframe id="output-frame" allow="camera; microphone; geolocation; notifications; accelerometer; magnetometer; bluetooth; nfc"></iframe>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs/loader.min.js"></script>

    <script>
        let editor, root = null, files = {}, currentFile = null, engine = 'monaco';

        const libraries = [
            { id: 'ThreeJS', n: 'Three.js (3D)', u: 'https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.0/three.min.js' },
            { id: 'GSAP', n: 'GSAP (Animation)', u: 'https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js' },
            { id: 'Tailwind', n: 'Tailwind CSS', u: 'https://cdn.tailwindcss.com' },
            { id: 'P5JS', n: 'P5.js (Art)', u: 'https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.js' },
            { id: 'SweetAlert', n: 'SweetAlert2', u: 'https://cdn.jsdelivr.net/npm/sweetalert2@11' },
            { id: 'ChartJS', n: 'Chart.js', u: 'https://cdn.jsdelivr.net/npm/chart.js' },
            { id: 'MatterJS', n: 'Matter.js (Physics)', u: 'https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js' },
            { id: 'AnimeJS', n: 'Anime.js', u: 'https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js' },
            { id: 'Howler', n: 'Howler.js (Audio)', u: 'https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.4/howler.min.js' },
            { id: 'ParticleJS', n: 'Particles.js', u: 'https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js' },
            { id: 'Axios', n: 'Axios (API)', u: 'https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js' },
            { id: 'Lottie', n: 'Lottie Web', u: 'https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.12.2/lottie.min.js' },
            { id: 'AFrame', n: 'A-Frame (VR)', u: 'https://aframe.io/releases/1.5.0/aframe.min.js' },
            { id: 'Locomotive', n: 'Locomotive Scroll', u: 'https://cdn.jsdelivr.net/npm/locomotive-scroll@4.1.4/dist/locomotive-scroll.min.js' },
            { id: 'JQuery', n: 'jQuery v3.7', u: 'https://code.jquery.com/jquery-3.7.1.min.js' },
            { id: 'ScrollReveal', n: 'ScrollReveal', u: 'https://unpkg.com/scrollreveal' },
            { id: 'VantaJS', n: 'Vanta Waves', u: 'https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.waves.min.js' },
            { id: 'DayJS', n: 'Day.js (Time)', u: 'https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js' },
            { id: 'Bootstrap', n: 'Bootstrap 5 CSS', u: 'https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css' },
            { id: 'Framer', n: 'Framer Motion', u: 'https://unpkg.com/framer-motion/dist/framer-motion.js' }
        ];

        require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs' }});
        require(['vs/editor/editor.main'], function() {
            editor = monaco.editor.create(document.getElementById('monaco-container'), {
                theme: 'vs-dark', fontSize: 16, automaticLayout: true,
                minimap: { enabled: false }, wordWrap: "on",
                lineNumbers: "on", fontFamily: "'Fira Code', monospace"
            });

            editor.onDidChangeModelContent(() => { if(currentFile) files[currentFile] = editor.getValue(); });
            document.getElementById('simple-container').addEventListener('input', (e) => { if(currentFile) files[currentFile] = e.target.value; });

            const list = document.getElementById('lib-market-list');
            libraries.forEach(lib => {
                const div = document.createElement('div');
                div.className = 'perm-item';
                div.innerHTML = `<span>${lib.n}</span> <button class="btn-run" style="font-size:10px; padding:5px 15px" onclick="installLib('${lib.id}', this)">Add</button>`;
                list.appendChild(div);
            });
        });

        function setEngine(mode) {
            engine = mode;
            document.getElementById('monaco-container').classList.remove('active-view');
            document.getElementById('simple-container').classList.remove('active-view');
            if(mode === 'monaco') {
                document.getElementById('monaco-container').classList.add('active-view');
                if(currentFile) editor.setValue(files[currentFile]);
            } else {
                document.getElementById('simple-container').classList.add('active-view');
                if(currentFile) document.getElementById('simple-container').value = files[currentFile];
            }
        }

        function updateFontSize(val) {
            document.getElementById('font-val').innerText = val;
            editor.updateOptions({ fontSize: parseInt(val) });
            document.getElementById('simple-container').style.fontSize = val + 'px';
        }

        async function openFolder() {
            try {
                root = await window.showDirectoryPicker({ mode: 'readwrite' });
                await refreshExplorer();
                toggleSidebar();
            } catch (e) {}
        }

        async function refreshExplorer() {
            const tree = document.getElementById('explorer-tree');
            tree.innerHTML = "";
            for await (const entry of root.values()) {
                if (entry.kind === 'file') {
                    const f = await entry.getFile();
                    files[entry.name] = await f.text();
                    const b = document.createElement('div');
                    b.className = 'btn'; b.style.padding = "10px"; b.innerHTML = `üìÑ ${entry.name}`;
                    b.onclick = () => openFile(entry.name);
                    tree.appendChild(b);
                }
            }
        }

        function openFile(name) {
            currentFile = name;
            const content = files[name];
            const ext = name.split('.').pop();
            const lang = ext === 'js' ? 'javascript' : ext === 'css' ? 'css' : 'html';
            if(engine === 'monaco') {
                monaco.editor.setModelLanguage(editor.getModel(), lang);
                editor.setValue(content);
            }
            document.getElementById('simple-container').value = content;
            document.getElementById('file-title').innerText = name;
        }

        async function installLib(libId, btn) {
            if(!root) return alert("Pehle folder open karein!");
            const lib = libraries.find(l => l.id === libId);
            btn.innerText = "Installing";
            btn.classList.add('installing-anim');
            try {
                const r = await fetch(lib.u);
                const h = await root.getFileHandle(`${lib.id}.js`, { create: true });
                const w = await h.createWritable();
                await w.write(await r.text());
                await w.close();
                await refreshExplorer();
                btn.classList.remove('installing-anim');
                btn.innerText = "Done ‚úì";
                btn.style.background = "var(--accent)";
            } catch(e) { 
                btn.innerText = "Error"; 
                btn.classList.remove('installing-anim');
            }
        }

        async function runApp() {
            if(!currentFile) return;
            const frame = document.getElementById('output-frame');
            let libs = "";
            Object.keys(files).forEach(f => { if(f.endsWith('.js')) libs += `<script src="${URL.createObjectURL(new Blob([files[f]], {type:'text/javascript'}))}"><\/script>\n`; });
            const html = currentFile.endsWith('.html') ? files[currentFile] : (files['index.html'] || "<h1>No index.html</h1>");
            const src = `<!DOCTYPE html><html><head>${libs}<style>${files['style.css'] || ""}</style></head><body>${html}<script>${files['script.js'] || ""}<\/script></body></html>`;
            frame.srcdoc = src;
            document.getElementById('output-screen').style.display = 'block';
        }

        function updateWrap(v) { editor.updateOptions({ wordWrap: v }); }
        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('active'); }
        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        function closeOutput() { document.getElementById('output-screen').style.display = 'none'; }
        function toggleFS() { document.fullscreenElement ? document.exitFullscreen() : document.documentElement.requestFullscreen(); }
        async function createFile() { if(!root) return; const n = prompt("File Name (e.g. index.html):"); if(n) { await root.getFileHandle(n, {create:true}); await refreshExplorer(); openFile(n); } }
    </script>
</body>
</html>
